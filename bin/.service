#!/bin/sh
set -u
echo "$(date -Iseconds)" "${0}" "${@}" >&2

service_name="$(basename "${0}" | tr _ -)"
extra_root="$(dirname -- "$(dirname -- "$(readlink -f "$0")")")"
export PATH="${PATH}:${extra_root}/bin"
# HOME is '/' when this script is run from the init process;
# some services expect the batocera default '/userdata/system' instead
if [ "${HOME}" = '/' ]; then
  export HOME='/userdata/system'
fi

case "${1-}" in
  start)   "${extra_root}/${service_name}/install-and-start"
           ;;
  stop)    "${extra_root}/${service_name}/stop"
           ;;
  *)
esac
